---
title: "Share_Class"
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
author: "Adrian D. Garcia"
date: "January 2020"
output: html_document
---

```{r setup, message=FALSE}
library(tidyverse)
library(readxl)
library(lubridate)
library(DT)
```

```{r data, message=FALSE}

INCEPTION <- read_excel(path = "launch-liquidation-data-for-adrian.xlsx", sheet = 1, na = "")

PATTERN <- c("(\\s)?([:alnum:]+)?( Load Waived)?( LW)?([:punct:]+)?([:alnum:]+)?(-[:alnum:])?(â„¢)?([:punct:]..[:punct:])?(\\s)?([:punct:][:alpha:]+[:punct:])?$")

CUT <- c("([:punct:]\\X\\X[:punct:])|(-)|(\\sLW)|(\\sLoad\\sWaived)|(\\([:alpha:]+\\))")


Data <- INCEPTION %>%  
  select(Name) %>% 
  mutate(
    Match = str_detect(Name, PATTERN),
    EXTRACT = str_extract(Name, PATTERN),
    New=str_trim(str_replace_all(EXTRACT,  CUT, ""))
    )
```

```{r data_show, echo=FALSE}
datatable(Data, options = list(autoWidth = TRUE, scrollX = TRUE))
```

```{r summary, message=FALSE}
ChangesSummaryTable <- Data %>%
  group_by(EXTRACT) %>% 
  summarise(cases = n()) %>%
  mutate(
    New=str_trim(str_replace_all(EXTRACT,  CUT, ""))
  ) %>% group_by(New) %>% 
  mutate(replacements=n(),
         newcases = sum(cases)) %>% 
  arrange(-newcases)

SummaryTable <- Data %>%
  group_by(New) %>% 
  summarise(cases = n()) %>% 
  arrange(-cases)
```

```{r summary_show, echo=FALSE}
datatable(ChangesSummaryTable)
```

```{r add, message=FALSE}
MODIFIED <- INCEPTION %>%  
  mutate(
    Match = str_detect(Name, PATTERN),
    EXTRACT = str_extract(Name, PATTERN),
    New=str_trim(str_replace_all(EXTRACT,  CUT, ""))    ) %>% 
  select(Name, Match, EXTRACT, New, 2:19)
         
```